generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Usuarios {
  idUsuario                  String                 @id @default(uuid())
  nombre                     String
  correo                     String                 @unique
  passwordHash               String
  rol                        String
  estado                     Boolean                @default(true)
  fechaRegistro              DateTime               @default(now())
  comentariosAuditoria       ComentariosAuditoria[]
  cuestionarios              CuestionarioIA[]
  decisionesAuditoria        DecisionesAuditoria[]
  documentos                 Documentos[]
  historial                  HistorialAcciones[]
  notificaciones             Notificaciones[]
  organizacion               Organizacion[]
  permisos                   Permisos[]
  procesosAuditoriaAsignados ProcesosAuditoria[]    @relation("ProcesosAuditoriaAuditor")
}

model Documentos {
  idDocumento          String               @id @default(uuid())
  idUsuarioPropietario String
  nombreArchivo        String
  tipoArchivo          String
  contenidoArchivo     Bytes?
  tamanoBytes          Int?
  fechaSubida          DateTime             @default(now())
  version              String?
  estado               String
  etiquetas            String?
  resumen              String?
  esAuditoria          Boolean              @default(false)
  esEliminado          Boolean              @default(false)
  usuarioPropietario   Usuarios             @relation(fields: [idUsuarioPropietario], references: [idUsuario])
  historial            HistorialAcciones[]
  permisos             Permisos[]
  procesosAuditoria    ProcesosAuditoria[]
  versiones            VersionesDocumento[]
}

model Permisos {
  idPermiso       String     @id @default(uuid())
  idUsuario       String
  idDocumento     String
  tipoAcceso      String
  fechaAsignacion DateTime   @default(now())
  documento       Documentos @relation(fields: [idDocumento], references: [idDocumento])
  usuario         Usuarios   @relation(fields: [idUsuario], references: [idUsuario])
}

model Organizacion {
  idOrganizacion  String         @id @default(uuid())
  idUsuario       String
  nombreCarpeta   String
  nivelJerarquico Int
  padreId         String?
  fechaCreacion   DateTime       @default(now())
  padre           Organizacion?  @relation("Jerarquia", fields: [padreId], references: [idOrganizacion])
  hijos           Organizacion[] @relation("Jerarquia")
  usuario         Usuarios       @relation(fields: [idUsuario], references: [idUsuario])
}

model CuestionarioIA {
  idCuestionario String   @id @default(uuid())
  idUsuario      String
  pregunta       String
  respuesta      String
  fechaRespuesta DateTime @default(now())
  usuario        Usuarios @relation(fields: [idUsuario], references: [idUsuario])
}

model ProcesosAuditoria {
  idProcesoAuditoria String                 @id @default(uuid())
  idDocumento        String
  idAuditor          String?
  nombre             String?
  estado             String                 @default("en_proceso")
  fechaLimite        DateTime?
  fechaCreacion      DateTime               @default(now())
  fechaActualizacion DateTime               @default(now())
  comentarios        ComentariosAuditoria[]
  criterios          CriteriosAuditoria[]
  decisiones         DecisionesAuditoria[]
  auditor            Usuarios?              @relation("ProcesosAuditoriaAuditor", fields: [idAuditor], references: [idUsuario])
  documento          Documentos             @relation(fields: [idDocumento], references: [idDocumento])
}

model ComentariosAuditoria {
  idComentarioAuditoria String            @id @default(uuid())
  idProcesoAuditoria    String
  idUsuario             String
  comentario            String?
  urlAdjunto            String?
  fechaComentario       DateTime          @default(now())
  usuario               Usuarios          @relation(fields: [idUsuario], references: [idUsuario])
  proceso               ProcesosAuditoria @relation(fields: [idProcesoAuditoria], references: [idProcesoAuditoria])
}

model CriteriosAuditoria {
  idCriterioAuditoria String            @id @default(uuid())
  idProcesoAuditoria  String
  titulo              String
  estado              String            @default("pendiente")
  notas               String?
  proceso             ProcesosAuditoria @relation(fields: [idProcesoAuditoria], references: [idProcesoAuditoria])
}

model DecisionesAuditoria {
  idDecisionAuditoria String            @id @default(uuid())
  idProcesoAuditoria  String
  idUsuario           String
  decision            String
  motivo              String?
  fechaDecision       DateTime          @default(now())
  usuario             Usuarios          @relation(fields: [idUsuario], references: [idUsuario])
  proceso             ProcesosAuditoria @relation(fields: [idProcesoAuditoria], references: [idProcesoAuditoria])
}

model HistorialAcciones {
  idHistorial String     @id @default(uuid())
  idUsuario   String
  idDocumento String
  accion      String
  fechaAccion DateTime   @default(now())
  detalle     String?
  documento   Documentos @relation(fields: [idDocumento], references: [idDocumento])
  usuario     Usuarios   @relation(fields: [idUsuario], references: [idUsuario])
}

model VersionesDocumento {
  idVersion     String     @id @default(uuid())
  idDocumento   String
  numeroVersion String
  rutaArchivo   String
  fechaVersion  DateTime   @default(now())
  documento     Documentos @relation(fields: [idDocumento], references: [idDocumento])
}

model Notificaciones {
  idNotificacion String   @id @default(uuid())
  idUsuario      String
  mensaje        String
  leido          Boolean  @default(false)
  fechaEnvio     DateTime @default(now())
  usuario        Usuarios @relation(fields: [idUsuario], references: [idUsuario])
}
