generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Usuarios {
  idUsuario     String   @id @default(uuid())
  nombre        String
  correo        String   @unique
  passwordHash  String
  rol           String
  estado        Boolean  @default(true)
  fechaRegistro DateTime @default(now())

  documentos     Documentos[]
  permisos       Permisos[]
  organizacion   Organizacion[]
  cuestionarios  CuestionarioIA[]
  historial      HistorialAcciones[]
  notificaciones Notificaciones[]
}

model Documentos {
  idDocumento          String @id @default(uuid())
  idUsuarioPropietario String
  nombreArchivo        String
  tipoArchivo          String

  contenidoArchivo Bytes?
  tamanoBytes      Int?

  fechaSubida DateTime @default(now())
  version     String?
  estado      String
  etiquetas   String?
  resumen     String?

  // ðŸ‘‡ Nuevo campo
  esAuditoria Boolean @default(false)
  esEliminado Boolean @default(false)

  usuarioPropietario Usuarios             @relation(fields: [idUsuarioPropietario], references: [idUsuario])
  permisos           Permisos[]
  historial          HistorialAcciones[]
  versiones          VersionesDocumento[]
}


model Permisos {
  idPermiso       String   @id @default(uuid())
  idUsuario       String
  idDocumento     String
  tipoAcceso      String
  fechaAsignacion DateTime @default(now())

  usuario   Usuarios   @relation(fields: [idUsuario], references: [idUsuario])
  documento Documentos @relation(fields: [idDocumento], references: [idDocumento])
}

model Organizacion {
  idOrganizacion  String   @id @default(uuid())
  idUsuario       String
  nombreCarpeta   String
  nivelJerarquico Int
  padreId         String?
  fechaCreacion   DateTime @default(now())

  usuario Usuarios       @relation(fields: [idUsuario], references: [idUsuario])
  padre   Organizacion?  @relation("Jerarquia", fields: [padreId], references: [idOrganizacion])
  hijos   Organizacion[] @relation("Jerarquia")
}

model CuestionarioIA {
  idCuestionario String   @id @default(uuid())
  idUsuario      String
  pregunta       String
  respuesta      String
  fechaRespuesta DateTime @default(now())

  usuario Usuarios @relation(fields: [idUsuario], references: [idUsuario])
}

model HistorialAcciones {
  idHistorial String   @id @default(uuid())
  idUsuario   String
  idDocumento String
  accion      String
  fechaAccion DateTime @default(now())
  detalle     String?

  usuario   Usuarios   @relation(fields: [idUsuario], references: [idUsuario])
  documento Documentos @relation(fields: [idDocumento], references: [idDocumento])
}

model VersionesDocumento {
  idVersion     String   @id @default(uuid())
  idDocumento   String
  numeroVersion String
  rutaArchivo   String
  fechaVersion  DateTime @default(now())

  documento Documentos @relation(fields: [idDocumento], references: [idDocumento])
}

model Notificaciones {
  idNotificacion String   @id @default(uuid())
  idUsuario      String
  mensaje        String
  leido          Boolean  @default(false)
  fechaEnvio     DateTime @default(now())

  usuario Usuarios @relation(fields: [idUsuario], references: [idUsuario])
}
